<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tapway Support (Safe Mode)</title>
    <style>
        :root { --bg: #0d1117; --text: #c9d1d9; --user: #1f6feb; --bot: #161b22; }
        body { margin: 0; font-family: sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; justify-content: center; }
        #app { width: 100%; max-width: 900px; display: flex; flex-direction: column; border: 1px solid #30363d; }
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .msg { max-width: 80%; padding: 10px 15px; border-radius: 6px; line-height: 1.5; font-size: 14px; white-space: pre-wrap; } /* pre-wrap preserves formatting */
        .user { background: var(--user); color: white; align-self: flex-end; }
        .bot { background: var(--bot); border: 1px solid #30363d; align-self: flex-start; }
        .input-box { padding: 15px; display: flex; gap: 10px; border-top: 1px solid #30363d; }
        input { flex: 1; padding: 10px; background: var(--bg); border: 1px solid #30363d; color: var(--text); }
        button { padding: 10px 20px; background: #238636; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
<div id="app">
    <div style="padding:15px; border-bottom:1px solid #333; font-weight:bold">ü§ñ Tapway Support</div>
    <div id="messages">
        <div class="msg bot">System Online. Ask me anything.</div>
    </div>
    <div class="input-box">
        <input type="text" id="userInput" placeholder="Type here..." onkeypress="if(event.key==='Enter') send()">
        <button onclick="send()">Send</button>
    </div>
</div>

<script>
    // 1. Paste your ngrok URL here (No trailing slash)
    const API_URL = "https://pseudomythically-penalizable-cristal.ngrok-free.dev"; 

    async function send() {
        const input = document.getElementById("userInput");
        const text = input.value;
        if (!text) return;

        addMsg("user", text);
        input.value = "Sending...";
        input.disabled = true;

        const formData = new FormData();
        formData.append("query", text);

        try {
            console.log("Sending request to:", `${API_URL}/chat`);
            const res = await fetch(`${API_URL}/chat`, { method: "POST", body: formData });
            
            if (!res.ok) throw new Error(`Server Status: ${res.status}`);
            
            const data = await res.json();
            console.log("Received data:", data);

            if (data.answer) {
                addMsg("bot", data.answer);
            } else {
                addMsg("bot", "‚ö†Ô∏è Server responded, but answer was empty.");
            }

        } catch (e) {
            console.error(e);
            addMsg("bot", `‚ùå Connection Error: ${e.message}`);
        } finally {
            input.value = "";
            input.disabled = false;
            input.focus();
        }
    }

    function addMsg(role, text) {
        const box = document.getElementById("messages");
        const div = document.createElement("div");
        div.className = `msg ${role}`;
        div.textContent = text; // Using simple textContent to prevent crashing
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }
</script>
</body>
</html>
